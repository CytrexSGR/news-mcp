{% extends "base.html" %}

{% block title %}{{ template.name }} - Content Templates{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="/admin/special-reports" class="text-decoration-none">Special Reports</a></li>
                    <li class="breadcrumb-item active text-muted">{{ template.name }}</li>
                </ol>
            </nav>
            <h1 class="h3 text-light">{{ template.name }}</h1>
            <p class="text-muted mb-0">{{ template.description }}</p>
        </div>
        <div>
            <span class="badge {% if template.is_active %}bg-success{% else %}bg-secondary{% endif %}">
                {% if template.is_active %}Active{% else %}Inactive{% endif %}
            </span>
        </div>
    </div>

    <!-- Template Info -->
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card h-100 border-secondary">
                <div class="card-header bg-dark border-secondary">
                    <h6 class="mb-0 text-light"><i class="fas fa-cog"></i> Configuration</h6>
                </div>
                <div class="card-body bg-dark">
                    <dl class="row mb-0">
                        <dt class="col-sm-6">Target Audience</dt>
                        <dd class="col-sm-6">{{ template.target_audience or 'N/A' }}</dd>

                        <dt class="col-sm-6">LLM Model</dt>
                        <dd class="col-sm-6"><code>{{ template.llm_model }}</code></dd>

                        <dt class="col-sm-6">Temperature</dt>
                        <dd class="col-sm-6">{{ template.llm_temperature }}</dd>

                        <dt class="col-sm-6">Schedule</dt>
                        <dd class="col-sm-6">{{ template.generation_schedule or 'On-demand' }}</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card h-100 border-secondary">
                <div class="card-header bg-dark border-secondary">
                    <h6 class="mb-0 text-light"><i class="fas fa-filter"></i> Selection Criteria</h6>
                </div>
                <div class="card-body bg-dark">
                    <dl class="row mb-0">
                        {% if template.selection_criteria.keywords %}
                        <dt class="col-sm-5">Keywords</dt>
                        <dd class="col-sm-7">
                            {% for kw in template.selection_criteria.keywords %}
                            <span class="badge bg-primary">{{ kw }}</span>
                            {% endfor %}
                        </dd>
                        {% endif %}

                        {% if template.selection_criteria.timeframe_hours %}
                        <dt class="col-sm-5">Timeframe</dt>
                        <dd class="col-sm-7">{{ template.selection_criteria.timeframe_hours }}h</dd>
                        {% endif %}

                        {% if template.selection_criteria.min_impact_score %}
                        <dt class="col-sm-5">Min Impact</dt>
                        <dd class="col-sm-7">{{ template.selection_criteria.min_impact_score }}</dd>
                        {% endif %}

                        <dt class="col-sm-5">Max Articles</dt>
                        <dd class="col-sm-7">{{ template.selection_criteria.max_articles }}</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card h-100 border-secondary">
                <div class="card-header bg-dark border-secondary">
                    <h6 class="mb-0 text-light"><i class="fas fa-file-alt"></i> Content Structure</h6>
                </div>
                <div class="card-body bg-dark">
                    <p class="mb-2"><strong>Output Format:</strong> {{ template.content_structure.output_format }}</p>
                    <p class="mb-2"><strong>Sections:</strong></p>
                    <ul class="mb-0">
                        {% for section in template.content_structure.sections %}
                        <li><code>{{ section.name }}</code> ({{ section.format }})</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Generated Content -->
    <div class="card border-secondary">
        <div class="card-header bg-dark border-secondary d-flex justify-content-between align-items-center">
            <h5 class="mb-0 text-light"><i class="fas fa-newspaper"></i> Generated Content</h5>
            <button class="btn btn-sm btn-primary"
                    hx-post="/htmx/templates/{{ template.id }}/refresh-content"
                    hx-target="#content-list"
                    hx-swap="innerHTML">
                <i class="fas fa-sync"></i> Refresh
            </button>
        </div>
        <div class="card-body bg-dark">
            <div id="content-list"
                 hx-get="/htmx/templates/{{ template.id }}/content"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading content...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Content Preview Modal -->
<div class="modal fade" id="contentPreviewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content bg-dark border-secondary">
            <div class="modal-header bg-dark border-secondary">
                <h5 class="modal-title text-light">Content Preview</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body bg-dark text-light" id="preview-content">
                <!-- Will be populated by HTMX -->
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
