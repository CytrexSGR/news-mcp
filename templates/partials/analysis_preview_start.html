<!-- Preview & Start Component -->
<div class="preview-panel p-3 bg-dark rounded">
    <!-- Analysis Breakdown Row -->
    <div class="row text-center mb-3">
        <div class="col-4">
            <div class="preview-stat">
                <div class="stat-value text-info" x-text="preview.total_items || preview.item_count || 0"></div>
                <div class="stat-label" style="color: white !important; font-weight: 500;">Total Selected</div>
            </div>
        </div>
        <div class="col-4">
            <div class="preview-stat">
                <div class="stat-value text-muted" x-text="preview.already_analyzed_count || preview.already_analyzed || 0"></div>
                <div class="stat-label" style="color: white !important; font-weight: 500;">Already Analyzed</div>
            </div>
        </div>
        <div class="col-4">
            <div class="preview-stat">
                <div class="stat-value text-primary" x-text="preview.new_items_count || preview.item_count || 0"></div>
                <div class="stat-label" style="color: white !important; font-weight: 500;">To Analyze</div>
            </div>
        </div>
    </div>

    <!-- Cost and Time Row -->
    <div class="row text-center">
        <div class="col-6">
            <div class="preview-stat">
                <div class="stat-value text-success">$<span x-text="(preview.estimated_cost_usd || 0).toFixed(3)"></span></div>
                <div class="stat-label" style="color: white !important; font-weight: 500;">Estimated Cost</div>
            </div>
        </div>
        <div class="col-6">
            <div class="preview-stat">
                <div class="stat-value text-warning" x-text="preview.estimated_duration_minutes || 0"></div>
                <div class="stat-label" style="color: white !important; font-weight: 500;">Est. Minutes</div>
            </div>
        </div>
    </div>

    <!-- Job Status Display -->
    <div x-show="currentJobStatus.status !== 'idle'" class="mt-2 p-2 rounded"
         :class="{
            'bg-primary': currentJobStatus.status === 'queued',
            'bg-warning': currentJobStatus.status === 'running',
            'bg-success': currentJobStatus.status === 'done',
            'bg-danger': currentJobStatus.status === 'error'
         }">
        <div class="d-flex align-items-center">
            <div x-show="currentJobStatus.status === 'running'" class="spinner-border spinner-border-sm me-2"></div>
            <div x-show="currentJobStatus.status === 'queued'" class="text-primary me-2">‚è≥</div>
            <div x-show="currentJobStatus.status === 'done'" class="text-success me-2">‚úÖ</div>
            <div x-show="currentJobStatus.status === 'error'" class="text-danger me-2">‚ùå</div>
            <small x-text="currentJobStatus.message" class="text-white"></small>
        </div>
        <div x-show="currentJobStatus.id" class="mt-1">
            <small class="text-white-50">Job ID: <span x-text="currentJobStatus.id"></span></small>
        </div>
    </div>

    <div class="mt-3 d-flex gap-2">
        <button class="btn btn-success flex-fill"
                @click="startRun()"
                :disabled="!activeSelection.mode || loading || currentJobStatus.status === 'running'">
            <span x-show="!loading && currentJobStatus.status !== 'running'">üöÄ Start Analysis</span>
            <span x-show="loading || currentJobStatus.status === 'running'">
                <span class="spinner-border spinner-border-sm" role="status"></span>
                <span x-show="loading">Starting...</span>
                <span x-show="currentJobStatus.status === 'running'">Running...</span>
            </span>
        </button>
        <button class="btn btn-secondary"
                @click="updatePreview()"
                :disabled="!activeSelection.mode || currentJobStatus.status === 'running'">
            üîÑ Refresh Preview
        </button>
    </div>
</div>